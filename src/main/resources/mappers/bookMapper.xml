<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="project.aban.test.dao.BookMapper">
	<insert id="insert_book" parameterType="java.util.List">
	<foreach collection="list" item="book" index="index" separator=" " open="INSERT ALL " close="SELECT * FROM DUAL">
		into book(
         	book_num,
			book_title,
			book_image,
			book_writer,
			book_date,
			book_publisher,
			book_content,
			book_likecount,
			book_viewcount,
			book_scrapcount
      		)values
			(
				#{book.book_num},
				#{book.book_title},
				#{book.book_image},
				#{book.book_writer},
				#{book.book_date},
				#{book.book_publisher},
				#{book.book_content},
				0,
                0,
                0
            )
		</foreach>
	</insert>
	
	<select id="select_book_recommend" resultType="Book">
        SELECT 
           *
        FROM book
        where rownum between 1 and 30
   </select>
   
    <select id="show_all_book" resultType="Book">
        SELECT 
        	BOOK_NUM,
        	BOOK_CONTENT
        FROM book
	</select>

	<select id="select_book" parameterType="Book" resultType="Book">
		select distinct
			book_num,
			book_title,
			book_image,
			book_writer,
			book_date,
			book_publisher,
			book_likecount
		from book
			where book_title = #{book_title}
			and book_image = #{book_image}
			and book_publisher = #{book_publisher}
	</select>
	
	<insert id="insert_tag" parameterType="java.util.List">
		<foreach collection="list" item="tag" index="index" separator=" " open="INSERT ALL " close="SELECT * FROM DUAL">
		into tag(
			tag_seq,
			tag,
			tag_count,
			hit_count,
			tag_image
		)values(
			#{tag.tag_seq},
			#{tag.tag},
			#{tag.tag_count},
			0,
			null
		)
		</foreach>
	</insert>
	
	<select id ="select_all_tag" resultType = "String">
		select tag from tag
		order by tag_count desc
	</select>

	<select id="show_tags" resultType="Tag">
        SELECT 
            *
        FROM tag
        ORDER BY
	        tag_count DESC
	</select>
	
	<insert id = "insert_taglist" parameterType = "java.util.List">
		<foreach collection="list" item="taglist" index="index" separator=" " open="INSERT ALL " close="SELECT * FROM DUAL">
		INTO TAGLIST(
			BOOK_NUM,
			TAG
		) VALUES (
			#{taglist.book_num},
			#{taglist.tag}
		)
		</foreach>
	</insert>
	
	<select id = "search_book" parameterType = "java.util.List" resultType = "Book">
		SELECT
		    BOOK.BOOK_NUM,
		    BOOK.BOOK_TITLE,
		    BOOK.BOOK_IMAGE,
		    BOOK.BOOK_WRITER,
		    BOOK.BOOK_DATE,
		    BOOK.BOOK_PUBLISHER,
		    BOOK.BOOK_CONTENT,
		    BOOK.BOOK_LIKECOUNT,
		    BOOK.BOOK_VIEWCOUNT,
		    BOOK.BOOK_SCRAPCOUNT,
		    TAGLIST.TAG
		FROM
		    BOOK, TAGLIST
		WHERE
		    BOOK.BOOK_NUM = TAGLIST.BOOK_NUM
			<foreach index="index" collection="list" item="tag" open="" close="" >
			AND TAGLIST.TAG = #{tag}
			</foreach>
			AND ROWNUM BETWEEN 1 AND 30
	</select>
	
	<delete id = "delete_taglist">
	delete taglist
	</delete>
	
	<delete id = "delete_tag">
	delete tag
	</delete>
	

</mapper>